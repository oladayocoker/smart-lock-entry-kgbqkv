
===========================================
RASPBERRY PI BACKEND SETUP INSTRUCTIONS
===========================================

This guide will help you set up and run the Smart Lock Entry backend on your Raspberry Pi.

PREREQUISITES:
--------------
1. Raspberry Pi (3B+, 4, or 5 recommended)
2. Raspberry Pi Camera Module (v1, v2, or HQ)
3. MicroSD card with Raspberry Pi OS installed
4. Internet connection
5. Python 3.9 or higher

STEP 1: ENABLE THE CAMERA
--------------------------
1. Open terminal on your Raspberry Pi
2. Run: sudo raspi-config
3. Navigate to: Interface Options > Camera
4. Select "Yes" to enable the camera
5. Reboot: sudo reboot

STEP 2: UPDATE SYSTEM
----------------------
sudo apt-get update
sudo apt-get upgrade -y

STEP 3: INSTALL SYSTEM DEPENDENCIES
------------------------------------
sudo apt-get install -y python3-pip python3-dev
sudo apt-get install -y libcap-dev
sudo apt-get install -y python3-opencv
sudo apt-get install -y libatlas-base-dev
sudo apt-get install -y python3-picamera2

STEP 4: INSTALL PYTHON DEPENDENCIES
------------------------------------
cd ~/smart-lock-entry/raspberry_pi
pip3 install -r requirements.txt

Note: If you encounter issues with picamera2, install it separately:
sudo apt-get install -y python3-picamera2

STEP 5: CONFIGURE GPIO (Optional)
----------------------------------
If you're using GPIO pins for the lock motor:
1. Make sure your user is in the gpio group:
   sudo usermod -a -G gpio $USER
2. Log out and log back in for changes to take effect

STEP 6: FIND YOUR RASPBERRY PI'S IP ADDRESS
--------------------------------------------
Run this command to find your Pi's local IP address:
hostname -I

Example output: 192.168.1.100

IMPORTANT: Do NOT use 127.0.0.1 or 127.0.1.1 - these are loopback addresses
and won't work from your mobile device!

STEP 7: RUN THE SERVER
----------------------
python3 server.py

The server will start on port 8000.
You should see output like:
  INFO:     Started server process
  INFO:     Uvicorn running on http://0.0.0.0:8000

STEP 8: CONFIGURE MOBILE APP
-----------------------------
1. Open the mobile app
2. Go to Settings
3. Enter your Raspberry Pi URL: http://YOUR_PI_IP:8000
   Example: http://192.168.1.100:8000
4. Save settings

STEP 9: TEST THE CONNECTION
----------------------------
From another device on the same network, open a web browser and visit:
http://YOUR_PI_IP:8000

You should see a JSON response with system status.

TROUBLESHOOTING:
----------------

1. "ModuleNotFoundError: No module named 'uvicorn'"
   Solution: pip3 install uvicorn

2. "AttributeError: 'Picamera2' object has no attribute 'allocator'"
   Solution: Update picamera2:
   sudo apt-get update
   sudo apt-get install -y python3-picamera2
   
   Or upgrade via pip:
   pip3 install --upgrade picamera2

3. "Camera init sequence did not complete"
   Solutions:
   - Check camera cable connection
   - Enable camera in raspi-config
   - Reboot the Pi
   - Check if another process is using the camera:
     sudo fuser -v /dev/video0

4. "Permission denied" errors with GPIO
   Solution: Add user to gpio group:
   sudo usermod -a -G gpio $USER
   Then log out and back in

5. Can't connect from mobile app
   Solutions:
   - Verify Pi and phone are on same WiFi network
   - Check firewall settings: sudo ufw allow 8000
   - Use the correct IP (not 127.0.0.1)
   - Ping the Pi from your phone's network

6. "Address already in use" error
   Solution: Kill existing process on port 8000:
   sudo lsof -ti:8000 | xargs kill -9

RUNNING AS A SERVICE (Optional):
---------------------------------
To run the server automatically on boot:

1. Create a systemd service file:
   sudo nano /etc/systemd/system/smart-lock.service

2. Add this content:
   [Unit]
   Description=Smart Lock Entry API
   After=network.target

   [Service]
   Type=simple
   User=pi
   WorkingDirectory=/home/pi/smart-lock-entry/raspberry_pi
   ExecStart=/usr/bin/python3 /home/pi/smart-lock-entry/raspberry_pi/server.py
   Restart=always

   [Install]
   WantedBy=multi-user.target

3. Enable and start the service:
   sudo systemctl enable smart-lock.service
   sudo systemctl start smart-lock.service

4. Check status:
   sudo systemctl status smart-lock.service

5. View logs:
   sudo journalctl -u smart-lock.service -f

SECURITY NOTES:
---------------
- This setup is for LOCAL NETWORK USE ONLY
- Do not expose port 8000 to the internet without proper security
- Consider adding authentication for production use
- Use HTTPS in production environments

SUPPORT:
--------
For issues or questions, check the project documentation or create an issue
on the project repository.
